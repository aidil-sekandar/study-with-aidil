---
import { subjectURL, filterBySubject } from "@/lib/utils/basicUtils";

import MainWindow from "@/components/MainWindow";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const allNotes = await getCollection("notes");
  const allTrials = await getCollection("trials");
  return allNotes.map((note) => {
    return {
      params: { subject: subjectURL(note.data.subject) },
      props: { allNotes, allTrials, subject: note.data.subject },
    };
  });
}

const { allNotes, allTrials, subject } = Astro.props;

console.log(allTrials);

const filteredNotes = filterBySubject(allNotes, subject);
const filteredTrials = filterBySubject(allTrials, subject);

const headTitle = subject;
---

<BaseLayout headTitle={headTitle}>
  <h1 slot="pageTitle" class="font-bold text-4xl mb-3">{subject}</h1>
  <MainWindow client:load allNotes={filteredNotes} allTrials={filteredTrials} />
</BaseLayout>
